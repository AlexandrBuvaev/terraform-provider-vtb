---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "vtb_balancer_v3_cluster Resource - terraform-provider-vtb"
subcategory: ""
description: |-
  Управление облачным продуктом Balancer V3
---

# vtb_balancer_v3_cluster (Resource)

Управление облачным продуктом Balancer V3

## Example Usage

```terraform
data "vtb_core_data" "dev" {
  platform    = "OpenStack"
  domain      = "corp.dev.vtb"
  net_segment = "dev-srv-app"
  zone        = "msk-north"
}

data "vtb_flavor_data" "c2m4" {
  cores  = 2
  memory = 4
}

data "vtb_balancer_v3_image_data" "img" {
  distribution = "astra"
  os_version   = "1.7"
}

data "vtb_cluster_layout" "balancer" {
  layout      = "balancer-1"
  net_segment = "dev-srv-app"
}

resource "vtb_balancer_v3_cluster" "test" {
  label             = "Load Balancer v3.4 Terraform"
  core              = data.vtb_core_data.dev
  flavor            = data.vtb_flavor_data.c2m4
  image             = data.vtb_balancer_v3_image_data.img
  financial_project = "VTB.Cloud"
  extra_mounts = {
    "/app" = {
      size = 50
    },
  }
  access = {
    "superuser" = [
      "cloud-soub-test1",
      "cloud-soub-test2",
    ],
  }
  layout_id = data.vtb_cluster_layout.balancer.id

  setup_version = "3.4.0"
  cluster_name  = "terra2"
  dns_zone      = "oslb-dev-dev.corp.dev.vtb"
  config = {
    backends = [
      {
        backend_name        = "back3"
        balancing_algorithm = "leastconn"
        cookie = {
          enable = false
        }
        globalname = "back3.terra2.soub.d5.oslb-dev-dev.corp.dev.vtb"
        healthcheck = {
          check_strings = [
            {
              send_proxy = "disabled"
            }
          ]
          fall_count = 3
          interval   = 5
          mode       = "tcp"
          rise_count = 3
        }
        keep_alive = {
          mode = "default"
        }
        mode = "tcp"
        retries = {
          count      = 3
          conditions = ["conn-failure"]
          enabled    = true
          redispatch = "disabled"
        }
        servers = [
          {
            address    = "10.170.10.26"
            maxconn    = 0
            name       = "mock_server"
            send_proxy = "disabled"
            state      = "active"
          }
        ]
        servers_settings = {
          port        = 12001
          slow_start  = 10
        }
      }
    ]

    defaults = {
      client_timeout  = 40
      connect_timeout = 10
      server_timeout  = 30
    }

    globals = {
      h2_workaround_bogus_websocket_clients = false
      maxconn                               = 10000
      tune_options = "h2_fe_initial_window_size: 666\nh2_header_table_size: 5000\nh2_max_frame_size: 16384"
    }

    ports = [
      {
        frontend_name = "frontend_12001_tcp"
        keep_alive = {
          tcp = {
            mode = "default"
          }
        }
        maxconn = 0
        mode    = "tcp"
        port    = 12001
      }
    ]

    publications = [
      {
        alive_serv_count = 1
        default_routing = true
        globalname      = "back3.terra2.soub.d5.oslb-dev-dev.corp.dev.vtb"
        main_backend    = "back3"
        mode            = "tcp"
        port            = 12001
      }
    ]
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `cluster_name` (String) Пользовательское имя кластера
- `core` (Attributes) Основные параметры для виртуальных машин в заказе. (see [below for nested schema](#nestedatt--core))
- `dns_zone` (String) DNS зона
- `extra_mounts` (Attributes Map) Дополнительные точки монтирования (see [below for nested schema](#nestedatt--extra_mounts))
- `financial_project` (String) Источник финансирования заказа
- `flavor` (Attributes) CPU/RAM виртуальных машин (see [below for nested schema](#nestedatt--flavor))
- `image` (Attributes) Тип вычислительного экземпляра (see [below for nested schema](#nestedatt--image))
- `label` (String) Метка заказа
- `layout_id` (String) Layout ID from geo_distribution.
- `setup_version` (String) Версия balancer v3

### Optional

- `access` (Map of Set of String) Карта, где ключом является роль, а значением - список групп, которые предоставляют доступ для входа в Active Directory
- `config` (Attributes) Схема конфигурации (see [below for nested schema](#nestedatt--config))
- `lifetime` (Number) Время жизни заказа в днях (2, 7, 14, 30)

### Read-Only

- `item_id` (String) Идентификатор сущностей ВМ, известен после создания ВМ
- `order_id` (String) Идентификатор заказа. Становится известен после создания заказа.

<a id="nestedatt--core"></a>
### Nested Schema for `core`

Required:

- `domain` (String) Название сетевого сегмента для заказа. Пример: dev-srv-app
- `net_segment` (String) Network segment name of order
- `platform` (String) Название платформы заказа Пример: OpenStack
- `zone` (String) Зона доступности, где будет размещен заказ. Пример: msk-north


<a id="nestedatt--extra_mounts"></a>
### Nested Schema for `extra_mounts`

Required:

- `size` (Number) Размер точки монтирования (в ГБ)

Read-Only:

- `file_system` (String) Тип файловой системы


<a id="nestedatt--flavor"></a>
### Nested Schema for `flavor`

Required:

- `cores` (Number) Количество ядер ЦПУ.
- `memory` (Number) Количество оперативной памяти RAM (указывается в ГБ).
- `name` (String) Кодовое название конфигурации.
- `uuid` (String) Уникальный идентификатор на странице справочников.


<a id="nestedatt--image"></a>
### Nested Schema for `image`

Required:

- `ad_integration` (Boolean) Флаг для интеграции виртуальной машины в Active Directory
- `distribution` (String) Название дистрибутива (RHEL или Astra).
- `geo_distribution` (Boolean) Механизм для включения/выключения геораспределения.
- `on_support` (Boolean) Флаг регулирущий режим работы группы сопровождения.
- `os_version` (String) Версия образа дистрибутива.
- `product_id` (String) Идентификатор продукта.


<a id="nestedatt--config"></a>
### Nested Schema for `config`

Required:

- `backends` (Attributes Set) Список бэкендов (see [below for nested schema](#nestedatt--config--backends))
- `defaults` (Attributes) Defaults (see [below for nested schema](#nestedatt--config--defaults))
- `globals` (Attributes) Globals (see [below for nested schema](#nestedatt--config--globals))
- `ports` (Attributes Set) Список портов (see [below for nested schema](#nestedatt--config--ports))
- `publications` (Attributes Set) Список публикаций (see [below for nested schema](#nestedatt--config--publications))

<a id="nestedatt--config--backends"></a>
### Nested Schema for `config.backends`

Required:

- `backend_name` (String) Имя бэкенда
- `balancing_algorithm` (String) Алгоритм распределения соединений
- `globalname` (String) Глобальное имя публикации
- `healthcheck` (Attributes) Проверки доступности (see [below for nested schema](#nestedatt--config--backends--healthcheck))
- `mode` (String) Режим работы
- `servers` (Attributes List) Список серверов (see [below for nested schema](#nestedatt--config--backends--servers))

Optional:

- `cookie` (Attributes) Настройки Cookie (see [below for nested schema](#nestedatt--config--backends--cookie))
- `forwardfor` (Attributes) Клиентский IP в заголовках (see [below for nested schema](#nestedatt--config--backends--forwardfor))
- `http_reuse` (Attributes) Настройки повторного использования HTTP (see [below for nested schema](#nestedatt--config--backends--http_reuse))
- `keep_alive` (Attributes) Настройки Keep-alive (see [below for nested schema](#nestedatt--config--backends--keep_alive))
- `retries` (Attributes) Настройки повторного соединения (see [below for nested schema](#nestedatt--config--backends--retries))
- `servers_settings` (Attributes) Настройки серверов (see [below for nested schema](#nestedatt--config--backends--servers_settings))

<a id="nestedatt--config--backends--healthcheck"></a>
### Nested Schema for `config.backends.healthcheck`

Required:

- `mode` (String) Тип проверки

Optional:

- `check_strings` (Attributes List) Последовательность проверок (see [below for nested schema](#nestedatt--config--backends--healthcheck--check_strings))
- `fall_count` (Number) Кол-во последовательных неудачных проверок
- `interval` (Number) Интервал проверки в секундах
- `rise_count` (Number) Кол-во последовательных удачных проверок

<a id="nestedatt--config--backends--healthcheck--check_strings"></a>
### Nested Schema for `config.backends.healthcheck.rise_count`

Required:

- `send_proxy` (String) Использовать Proxy протокол

Optional:

- `address` (String) Адрес проверки
- `body` (String) Тело для PUT запроса
- `host_hdr` (String) Заголовок хоста
- `match` (String) Тип ожидаемого ответа от сервера
- `method` (String) Метод проверки
- `port` (Number) Порт для проверки
- `uri` (String) URI проверкиы
- `use_ssl` (String) Использование SSL
- `value` (String) Значение ожидаемого ответа от сервера
- `version` (String) Версия протокола HTTP



<a id="nestedatt--config--backends--servers"></a>
### Nested Schema for `config.backends.servers`

Required:

- `address` (String) IP адрес сервера
- `maxconn` (Number) Максимальное кол-во одновременных подключений к серверу
- `name` (String) Название сервера
- `state` (String) Режим работы сервера

Optional:

- `send_proxy` (String) Использование ProxyProtocol
- `weight` (Number) Вес сервера


<a id="nestedatt--config--backends--cookie"></a>
### Nested Schema for `config.backends.cookie`

Required:

- `enable` (Boolean) Enable cookie persistence

Optional:

- `secure` (Boolean) Use secure cookie


<a id="nestedatt--config--backends--forwardfor"></a>
### Nested Schema for `config.backends.forwardfor`

Required:

- `xff` (Boolean) Добавить X-Forwarded-For заголовок

Optional:

- `xcip` (Boolean) Заменить X-Client-IP заголовок
- `xrip` (Boolean) Заменить X-Real-IP заголовок


<a id="nestedatt--config--backends--http_reuse"></a>
### Nested Schema for `config.backends.http_reuse`

Optional:

- `mode` (String) Режим повторного использования HTTP
- `pool_low_conn` (Number) Минимальное кол-во постоянных открытых соединений
- `pool_max_conn` (Number) Максимальное кол-во постоянных открытых соединений
- `pool_purge_delay` (Number) Интервал очистки соединения


<a id="nestedatt--config--backends--keep_alive"></a>
### Nested Schema for `config.backends.keep_alive`

Optional:

- `mode` (String) Режим работы keep-alive
- `timer` (Number) Время жизни соединений


<a id="nestedatt--config--backends--retries"></a>
### Nested Schema for `config.backends.retries`

Optional:

- `conditions` (List of String) Условия повторного соединения
- `count` (Number) Количество попыток повторного соединения
- `enabled` (Boolean) Включить повторное соединение
- `redispatch` (String) Повторное соединение с другим сервером


<a id="nestedatt--config--backends--servers_settings"></a>
### Nested Schema for `config.backends.servers_settings`

Required:

- `port` (Number) Порт подключения к серверам

Optional:

- `http_settings` (Attributes) HTTP settings (see [below for nested schema](#nestedatt--config--backends--servers_settings--http_settings))
- `slow_start` (Number) Время медленного старта в секундах
- `tls_profile` (String) Профиль TLS
- `use_sni` (Boolean) Отправка Sni

<a id="nestedatt--config--backends--servers_settings--http_settings"></a>
### Nested Schema for `config.backends.servers_settings.use_sni`

Optional:

- `grpc_over_http2` (Boolean) Use gRPC over HTTP2
- `version_activation_priority` (Attributes List) List of versions (see [below for nested schema](#nestedatt--config--backends--servers_settings--use_sni--version_activation_priority))

<a id="nestedatt--config--backends--servers_settings--use_sni--version_activation_priority"></a>
### Nested Schema for `config.backends.servers_settings.use_sni.version_activation_priority`

Required:

- `version` (String) version of http





<a id="nestedatt--config--defaults"></a>
### Nested Schema for `config.defaults`

Optional:

- `client_timeout` (Number) Таймаут бездействия клиента в секундах
- `connect_timeout` (Number) Время ожидания клиентского соединения в секундах
- `server_timeout` (Number) Таймаут ответа сервера в секундах


<a id="nestedatt--config--globals"></a>
### Nested Schema for `config.globals`

Optional:

- `h2_workaround_bogus_websocket_clients` (Boolean) Отключение HTTP2 для использования websocket
- `maxconn` (Number) Максимальное кол-во одновременных подключений к каждому узлу балансироващика
- `tune_options` (String) Опциональные настройки тюнинга


<a id="nestedatt--config--ports"></a>
### Nested Schema for `config.ports`

Required:

- `mode` (String) Режим работы
- `port` (Number) Порт

Optional:

- `http_settings` (Attributes) HTTP settings (see [below for nested schema](#nestedatt--config--ports--http_settings))
- `keep_alive` (Attributes) Настройки keep-alive (see [below for nested schema](#nestedatt--config--ports--keep_alive))
- `maxconn` (Number) Максимальное кол-во одновременных подключений к каждому узлу балансировщика
- `prescription` (Attributes) Предписания клиенту подключаться по HTTPS (see [below for nested schema](#nestedatt--config--ports--prescription))
- `redirect` (Attributes) Настройки перенаправления HTTP на HTTPs (see [below for nested schema](#nestedatt--config--ports--redirect))
- `tls_profile` (String) Профиль SSL/TLS

<a id="nestedatt--config--ports--http_settings"></a>
### Nested Schema for `config.ports.http_settings`

Optional:

- `grpc_over_http2` (Boolean) Use gRPC over HTTP2
- `version_activation_priority` (Attributes List) List of versions (see [below for nested schema](#nestedatt--config--ports--http_settings--version_activation_priority))

<a id="nestedatt--config--ports--http_settings--version_activation_priority"></a>
### Nested Schema for `config.ports.http_settings.version_activation_priority`

Required:

- `version` (String) version of http



<a id="nestedatt--config--ports--keep_alive"></a>
### Nested Schema for `config.ports.keep_alive`

Optional:

- `http` (Attributes) Настройки HTTP keep-alive (see [below for nested schema](#nestedatt--config--ports--keep_alive--http))
- `tcp` (Attributes) Настройки TCP keep-alive (see [below for nested schema](#nestedatt--config--ports--keep_alive--tcp))

<a id="nestedatt--config--ports--keep_alive--http"></a>
### Nested Schema for `config.ports.keep_alive.tcp`

Optional:

- `mode` (String) Режим работы keep-alive
- `timer` (Number) Время жизни соединений в секундах


<a id="nestedatt--config--ports--keep_alive--tcp"></a>
### Nested Schema for `config.ports.keep_alive.tcp`

Optional:

- `count` (Number) Кол-во keep-alive проб
- `mode` (String) Режим работы keep-alive
- `timer` (Number) Время жизни соединений в секундах



<a id="nestedatt--config--ports--prescription"></a>
### Nested Schema for `config.ports.prescription`

Required:

- `enabled` (Boolean) Предписывать дальнейшие подключения

Optional:

- `include_subdomains` (Boolean) Include subdomains
- `live_time` (Number) Время жизни предписания в секундах


<a id="nestedatt--config--ports--redirect"></a>
### Nested Schema for `config.ports.redirect`

Required:

- `enabled` (Boolean) Включить перенаправление с 80 на 443 порт



<a id="nestedatt--config--publications"></a>
### Nested Schema for `config.publications`

Required:

- `alive_serv_count` (Number) Минимальное кол-во работоспособных серверов
- `globalname` (String) Имя глобальной публикации
- `main_backend` (String) Main бэкенд
- `mode` (String) Режим работы
- `port` (Number) Номер порта

Optional:

- `cnames` (List of String) CNAMEs приложения
- `default_routing` (Boolean) Использование маршрута по умолчанию
- `routes` (Attributes List) Условия маршрутизации (see [below for nested schema](#nestedatt--config--publications--routes))
- `standin_backends` (Set of String) StandIn бэкенды

<a id="nestedatt--config--publications--routes"></a>
### Nested Schema for `config.publications.routes`

Optional:

- `headers` (Attributes List) Заголовки (see [below for nested schema](#nestedatt--config--publications--routes--headers))
- `ips` (List of String) IP/Network адрес
- `uri` (Attributes List) Условия URI (see [below for nested schema](#nestedatt--config--publications--routes--uri))

<a id="nestedatt--config--publications--routes--headers"></a>
### Nested Schema for `config.publications.routes.uri`

Required:

- `check_type` (String) Тип сопоставления
- `name` (String) Названия заголовка

Optional:

- `value` (String) Значение заголовка


<a id="nestedatt--config--publications--routes--uri"></a>
### Nested Schema for `config.publications.routes.uri`

Required:

- `endpoints` (List of String) Endpoints

Optional:

- `condition` (String) Тип сопоставления

## Import

Import is supported using the following syntax:

```shell
tofu import vtb_balancer_v3_cluster.test <order_id>
```
