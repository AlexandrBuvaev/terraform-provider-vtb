---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "vtb_airflow_cluster Resource - terraform-provider-vtb"
subcategory: ""
description: |-
  
---

# vtb_airflow_cluster (Resource)



## Example Usage

```terraform
data "vtb_core_data" "dev" {
  platform    = "OpenStack"
  domain      = "corp.dev.vtb"
  net_segment = "dev-srv-app"
  zone        = "msk-north"
}

data "vtb_flavor_data" "c4m16" {
  cores  = 4
  memory = 16
}

data "vtb_airflow_image_data" "airflow_img_cluster" {
  distribution = "astra"
  product_type = "cluster"
  os_version   = "1.7"
}

data "vtb_cluster_layout" "airflow" {
  layout      = "one_dc:webserver-2:scheduler-2:worker-4"
  net_segment = "dev-srv-app"
}

resource "vtb_airflow_cluster" "airflow_cluster" {
  lifetime          = 30
  label             = "Terraform Airflow Cluster"
  financial_project = "VTB.Cloud"
  core              = data.vtb_core_data.dev
  flavor_worker     = data.vtb_flavor_data.c4m16
  flavor_scheduler  = data.vtb_flavor_data.c4m16
  flavor_webserver  = data.vtb_flavor_data.c4m16
  image             = data.vtb_airflow_image_data.airflow_img_cluster
  layout_id         = data.vtb_cluster_layout.airflow.id
  extra_mounts = {
    "/app" = {
      size = 30
    },
    "/app_data" = {
      size = 30
    }
  }
  access = {
    "superuser" = [
      "cloud-soub-airflow-dev"
    ]
  }
  deploy_grants = {
    airflow_deploy = [
      "cloud-soub-deploy"
    ]
  }
  web_console_grants = {
    "Operator" = [
      "cloud-soub-airflow-dev"
    ]
  }
  postgresql_config = {
    db_order_id = "6d1d1165-5b60-4df4-956a-657a0b9229f7"
    db_user     = "airflow_cluster_tf_admin"
    db_database = "airflow_cluster_tf"
    db_password = "_NFlkqNzTjvll9_J_XyH4zo41asjw6M67RIEadETMCv_V6U53cbIiD163j-EKOFSpqGamXnKNxSJd7S0CbPFOCecnQ.5yKTcjwCxcHs"
  }
  rabbitmq_config = {
    broker_order_id = "d08ab921-9666-4803-b00d-dac247a19448"
    broker_vhost    = "airflow-clu-005"
  }
  update_product_mode = "latest"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `access` (Map of Set of String) Разрешения для входа в Active Directory.
- `cluster_name` (String) Имя кластера
- `core` (Attributes) Основные параметры для вирутальных машин в заказе. (see [below for nested schema](#nestedatt--core))
- `deploy_grants` (Attributes) Группы доступа для добавления DAG-файлов (see [below for nested schema](#nestedatt--deploy_grants))
- `extra_mounts` (Attributes Map) Дополнительные точки монтирования для ВМ. (see [below for nested schema](#nestedatt--extra_mounts))
- `financial_project` (String) Источник финансирования для заказа.
- `flavor_scheduler` (Attributes) Кол-во CPU/RAM для виртуальных машин с ролью scheduler. (see [below for nested schema](#nestedatt--flavor_scheduler))
- `flavor_webserver` (Attributes) Кол-во CPU/RAM для виртуальных машин с ролью webserver. (see [below for nested schema](#nestedatt--flavor_webserver))
- `flavor_worker` (Attributes) Кол-во CPU/RAM для виртуальных машин с ролью worker. (see [below for nested schema](#nestedatt--flavor_worker))
- `image` (Attributes) Тип вычислительного экземпляра. (see [below for nested schema](#nestedatt--image))
- `label` (String) Имя заказа.
- `layout_id` (String) Идентификатор layout из справочника geo_distribution.
- `postgresql_config` (Attributes) Конфигурация компонента PostgreSQL (see [below for nested schema](#nestedatt--postgresql_config))
- `rabbitmq_config` (Attributes) Конфигурация компонента RabbitMQ (see [below for nested schema](#nestedatt--rabbitmq_config))
- `web_console_grants` (Map of Set of String) Группы доступа к консоли управления.

### Optional

- `lifetime` (Number) Время жизни заказа в днях (2, 7, 14, 30)
- `update_product_mode` (String) Мод для регулировки политики обновлений продукта("latest/none"), если флаг проставлен в "latest"
				                     то будет активировано действие "Обвновить версию релиза продукта"

### Read-Only

- `build_version` (String) Версия релиза продукта
- `executor` (String) Тип Airflow executor (localexecutor или celeryexecutor).
- `item_id` (String) Идентификатор сущностей ВМ, известен после создания ВМ.
- `order_id` (String) Идентификатор заказа, известен после создания заказа.

<a id="nestedatt--core"></a>
### Nested Schema for `core`

Required:

- `domain` (String) Название сетевого сегмента для заказа. Пример: dev-srv-app
- `net_segment` (String) Network segment name of order
- `platform` (String) Название платформы заказа Пример: OpenStack
- `zone` (String) Зона доступности, где будет размещен заказ. Пример: msk-north


<a id="nestedatt--deploy_grants"></a>
### Nested Schema for `deploy_grants`

Required:

- `airflow_deploy` (Set of String)


<a id="nestedatt--extra_mounts"></a>
### Nested Schema for `extra_mounts`

Required:

- `size` (Number) Размер точки монтирования (в Гб)

Read-Only:

- `file_system` (String) Тип файловой системы.


<a id="nestedatt--flavor_scheduler"></a>
### Nested Schema for `flavor_scheduler`

Required:

- `cores` (Number) Количество ядер ЦПУ.
- `memory` (Number) Количество оперативной памяти RAM (указывается в ГБ).
- `name` (String) Кодовое название конфигурации.
- `uuid` (String) Уникальный идентификатор на странице справочников.


<a id="nestedatt--flavor_webserver"></a>
### Nested Schema for `flavor_webserver`

Required:

- `cores` (Number) Количество ядер ЦПУ.
- `memory` (Number) Количество оперативной памяти RAM (указывается в ГБ).
- `name` (String) Кодовое название конфигурации.
- `uuid` (String) Уникальный идентификатор на странице справочников.


<a id="nestedatt--flavor_worker"></a>
### Nested Schema for `flavor_worker`

Required:

- `cores` (Number) Количество ядер ЦПУ.
- `memory` (Number) Количество оперативной памяти RAM (указывается в ГБ).
- `name` (String) Кодовое название конфигурации.
- `uuid` (String) Уникальный идентификатор на странице справочников.


<a id="nestedatt--image"></a>
### Nested Schema for `image`

Required:

- `ad_integration` (Boolean) Флаг для интеграции виртуальной машины в Active Directory
- `airflow_version` (String) Версия ядра Airflow
- `distribution` (String) Название дистрибутива (RHEL или Astra).
- `geo_distribution` (Boolean) Включение/выключение механизма геораспределения.
- `on_backup` (Boolean) Флаг постановки на СРК RuBackup
- `on_support` (Boolean) Флаг регулирущий режим работы группы сопровождения.
- `os_version` (String) Версия образа дистрибутива.
- `product_id` (String) Идентификатор продукта.
- `product_type` (String) Тип Airflow установки: stand-alone или cluster.


<a id="nestedatt--postgresql_config"></a>
### Nested Schema for `postgresql_config`

Required:

- `db_database` (String) Имя БД
- `db_order_id` (String) Order_id заказа PostgreSQL
- `db_password` (String, Sensitive) Пароль владельца БД
- `db_user` (String) Владелец БД


<a id="nestedatt--rabbitmq_config"></a>
### Nested Schema for `rabbitmq_config`

Required:

- `broker_order_id` (String) OrderID брокера RabbitMQ
- `broker_vhost` (String) Имя виртуального хоста RabbitMQ

Read-Only:

- `rabbitmq_cert_cn` (String) CN сертификата RabbitMQ

## Import

Import is supported using the following syntax:

```shell
tofu import vtb_airflow_cluster.airflow_cluster <order_id>
```
